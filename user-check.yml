---
- name: This playbook will create a file
  hosts: all 
  vars:
    store_file: "/tmp/user-check.txt"
  tasks:
    - name: To check the uses - uid=0 or uid > 1000 
      ansible.builtin.shell: "cat /etc/passwd | awk -F: '$3>1000||$3==0{print $1\": \"$3}'"
      register: userlist
    - name: Clean the oringinal stored file
      ansible.builtin.file:
        path: "{{ store_file }}"
        state: absent
    - debug:
        var:  "{{ userlist.stdout }}"
    - name: Log hostname in a file
      ansible.builtin.lineinfile:
        path: "{{ store_file }}"
        line: "{{ ansible_host }}"
        create: true
        state: present
      delegate_to: localhost
    - name: To append the username in a file
      ansible.builtin.lineinfile:
        path: "{{ store_file }}"
        line: "- {{ item }}"
        create: true
        state: present
      with_items: "{{ userlist.stdout_lines }}"
      delegate_to: localhost
